<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>JSDoc: Source: tasks.js</title>

    <script src="scripts/prettify/prettify.js"> </script>
    <script src="scripts/prettify/lang-css.js"> </script>
    <!--[if lt IE 9]>
      <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <link type="text/css" rel="stylesheet" href="styles/prettify-tomorrow.css">
    <link type="text/css" rel="stylesheet" href="styles/jsdoc-default.css">
</head>

<body>

<div id="main">

    <h1 class="page-title">Source: tasks.js</h1>

    



    
    <section>
        <article>
            <pre class="prettyprint source linenums"><code>/**
 * @file Angular.js + VanilaCSS CRUD
 * @copyright Talita Pagani 2016
 */
(function(angular) {

    'use strict';

    /**
    * The AngularJS module 'TaskTest'
    * @namespace App
    */
    var app = angular.module('TasksTest', []);

    /**
    * Factory for Local Storage
    * @kind function
    * @memberof App
    * @private
    */
    app.factory("LocalStorage", function() {
        var LS = {};
        LS.getItem = function(key) {
            return localStorage[key];
        };
        LS.setItem = function(key, value) {
            localStorage[key] = value;
            return value;
        };

        return LS;
    });

    /**
    * TasksTest single controller
    * @name TaskMgmt
    * @memberof App
    *
    * @param {string} controllerName - The name of the controller, binding the HTML
    * @param {Object[]} [dependencies] - The $scope and other dependencies 
    * @param {function} callback - Callback function passing the current scope and modules/factory to be used inside the controller
    *
    * @property {number} tasks.taskID - The ID of some active task in edit or delete mode. Bing the input field.
    * @property {string} tasks.name - Binding for the input field of the task to be added/edited
    * @property {string} tasks.description - Binding for the input field of the task to be added/edited
    */
    app.controller('TaskMgmt', ['$scope', '$timeout', 'LocalStorage', function ($tasks, $timeout, LocalStorage) {

        /**
         * A flag to show or hide the Add/Edit modal dialog
         * @type {boolean}
         */
        $tasks.showModal = false;
        /**
         * A flag to show or hide the Delete modal dialog
         * @type {boolean}
         */
        $tasks.showModalDelete = false;
        /**
         * Flag indicating if the task is being edited of it's adding a new task
         * @type {boolean}
         */
        $tasks.edit = false;
        /**
         * Flag to show/hide the 'loading wheel' feedback
         * @type {boolean}
         */
        $tasks.loading = false;
        /**
         * Return the tasks saved at LocalStorage in JSON format or initiate a new array if LocalStorage is empty
         * @type {Object[]}
         */
        $tasks.list = LocalStorage.getItem("dbTasks") ? JSON.parse(LocalStorage.getItem("dbTasks")) : [];
        /**
         * Scoped cache for the task that is being edited
         * @type {Object}
         */
        $tasks.current = null;

        /** 
        * Return the Task object and its index in the task list array
        * @private
        * @memberof TaskMgmt
        * @param {number} taskId - The unique ID of the task to be edited/deleted
        * @return {Object}
        */
        function getTask(taskId) {

            // Using 'let' to ensure that the variables will work only on this scope
            let i = 0, l = $tasks.list.length, task = { "obj": null, "index": 0 };

            for(; i &lt; l; i++) {
                if ($tasks.list[i].id == taskId) {
                    task["obj"] = $tasks.list[i];
                    task["index"] = i;
                }
            }

            return task;

        }

        /** 
        * Show the Add/Edit modal dialog and enable edit mode if a task id is specified
        * @public
        * @memberof TaskMgmt
        * @param {number} taskId - The unique ID of the task to be edited
        */
        $tasks.editTask = function (taskId) {
            $tasks.showModal = true;
            $tasks.edit = true;

            // Stores in the controller cache the current task to be edited
            $tasks.current = getTask(taskId)["obj"];

            $tasks.taskID = taskId;
            $tasks.name = $tasks.current.name;
            $tasks.description = $tasks.current.description;
        };

        /** 
        * Show the Add/Edit modal dialog in the 'add' mode (default)
        * @public
        * @memberof TaskMgmt
        */
        $tasks.addTask = function () {
            $tasks.showModal = true;
        };

        /** 
        * Show the Delete modal dialog and store the id of the task to be deleted in the scope
        * @public
        * @memberof TaskMgmt
        * @param {number} taskId - The unique ID of the task to be deleted
        */
        $tasks.deleteTask = function (taskId) {
            $tasks.showModalDelete = true;

            $tasks.taskID = taskId;
        };

        /** 
        * Update an existing task or create a new task, both in the scope and LocalStorage
        * @public
        * @memberof TaskMgmt
        * @param {number} taskId - The unique ID of the task to be edited
        * @param {Object} form - The add/edit form to be reset after submit
        */
        $tasks.updateTask = function (taskId, form) {

            if($tasks.name !== "" &amp;&amp; $tasks.description !== "") {

                $tasks.showModal = false;
                $tasks.loading = true;

                if(taskId) {
                    $tasks.current.name = $tasks.name;
                    $tasks.current.description = $tasks.description;

                    $tasks.edit = false;
                } else {
                    // Generate a unique ID: if PerformanceTimeline API is available, 
                    // round performance.now(), which is the high precision timer,
                    // otherwise, use Date.getTime() as fallback
                    var id_gen = (window.performance &amp;&amp; typeof window.performance.now === "function") ? Math.floor(performance.now()) : Math.floor(new Date().getTime());

                    $tasks.list.push({
                        id: id_gen,
                        name: $tasks.name,
                        description: $tasks.description,
                        done: false
                    });
                }

                localStorage.setItem("dbTasks", JSON.stringify($tasks.list));

                form.$setPristine();
                form.$setUntouched();

                $tasks.taskID = null;
                $tasks.name = '';
                $tasks.description = '';

                $timeout(function() {
                    $tasks.loading = false;
                }, 2000);
            }
        };

        /** 
        * Perform the delete of the selected task after user confirms. Update the scope array and LocalStorage
        * @public
        * @memberof TaskMgmt
        * @param {number} taskId - The unique ID of the task to be deleted
        */
        $tasks.confirmDeleteTask = function(taskId) {

            $tasks.showModalDelete = false;
            $tasks.loading = true;

            let index = getTask(taskId)["index"];

            $tasks.list.splice(index, 1);

            localStorage.setItem("dbTasks", JSON.stringify($tasks.list));

            $tasks.taskID = null;

            $timeout(function() {
                $tasks.loading = false;
            }, 2000);
        };

        /** 
        * Cancel the Add/Edit/Delete operation and close the modal dialog
        * @public
        * @memberof TaskMgmt
        * @param {number} [form] - the form to be reset
        * @param {string} [option] - closes de delete modal if 'Delete' is specified, otherwise, closes Add/Edit modal
        */
        $tasks.cancel = function (form, option) {
            if(option == "Delete") {
                $tasks.taskID = null;
                $tasks.showModalDelete = false;
            } else {
                $tasks.taskID = null;
                $tasks.name = '';
                $tasks.description = '';
                $tasks.showModal = false;
                $tasks.edit = false;
                form.$setPristine();
                form.$setUntouched();
            }
        };

        /** 
        * Change the status of a task. Update the scope list and LocalStorage
        * @public
        * @memberof TaskMgmt
        * @param {number} index - The index in the array
        * @param {boolean} taskDone - the status of the task: 'true' for done and 'false' for in progress
        */
        $tasks.finishTask = function(index, taskDone) {

            $tasks.list[index].done = taskDone;

            localStorage.setItem("dbTasks", JSON.stringify($tasks.list));

        }
    }]);

})(window.angular);</code></pre>
        </article>
    </section>




</div>

<nav>
    <h2><a href="index.html">Home</a></h2><h3>Namespaces</h3><ul><li><a href="App.html">App</a></li></ul>
</nav>

<br class="clear">

<footer>
    Documentation generated by <a href="https://github.com/jsdoc3/jsdoc">JSDoc 3.4.0</a> on Sun Jan 24 2016 01:29:18 GMT-0200 (Horário brasileiro de verão)
</footer>

<script> prettyPrint(); </script>
<script src="scripts/linenumber.js"> </script>
</body>
</html>
